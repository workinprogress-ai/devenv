#!/bin/bash
# bash-functions.sh - Common bash functions and aliases for devenv

alias ll='ls -lah'

# Navigate to a repository and clone/update it if needed
repo-get() {
    bash "$DEVENV_ROOT/scripts/repo-get.sh" "$@"
    if [ -d "$DEVENV_ROOT/repos/$1" ]; then
        cd "$DEVENV_ROOT/repos/$1" || return
    fi
}

# Navigate to devenv root
devenv() {
    cd "$DEVENV_ROOT" || return
}

# Navigate to playground directory
playground() {
    cd "$DEVENV_ROOT/playground" || return
}

# Navigate to repos directory
repos() {
    cd "$DEVENV_ROOT/repos" || return
}

# Update the devenv repository itself
update-dev-env() {
    local current_dir
    current_dir=$(pwd)
    cd "$DEVENV_ROOT" || return
    git-update
    cd "$current_dir" || return
    "$DEVENV_ROOT/.devcontainer/check-update-devenv-repo.sh"
}

# Update GitHub token in setup
update-github-token() {
    "$DEVENV_ROOT/scripts/update-github-token.sh" "$@"
}

# Update all repositories in parallel
repo-update-all() {
    "$DEVENV_ROOT/scripts/repo-update-all.sh" "$@"
}

# Create a PR for merge (conventional commit title required)
pr-create-for-merge() {
    "$DEVENV_ROOT/scripts/pr-create-for-merge.sh" "$@"
}

# Create a review PR (for comparing commits)
pr-create-for-review() {
    "$DEVENV_ROOT/scripts/pr-create-for-review.sh" "$@"
}

# Get PR link for current branch
pr-get-merge-link() {
    "$DEVENV_ROOT/scripts/pr-get-merge-link.sh" "$@"
}

# Get review PR link
pr-get-review-link() {
    "$DEVENV_ROOT/scripts/pr-get-review-link.sh" "$@"
}

# Cleanup old review branches
pr-cleanup-review-branches() {
    "$DEVENV_ROOT/scripts/pr-cleanup-review-branches.sh" "$@"
}

# List version tags with colors
repo-version-list() {
    "$DEVENV_ROOT/scripts/repo-version-list.sh" "$@"
}

# Get repository web URL
repo-get-web-url() {
    "$DEVENV_ROOT/scripts/repo-get-web-url.sh" "$@"
}

# Create a new script from template
create-script() {
    "$DEVENV_ROOT/scripts/create-script.sh" "$@"
}

# Lint all shell scripts with shellcheck
lint-scripts() {
    "$DEVENV_ROOT/scripts/lint-scripts.sh" "$@"
}

# Start/stop dependencies (docker compose)
dependencies-up() {
    "$DEVENV_ROOT/scripts/dependencies-up.sh" "$@"
}

dependencies-down() {
    "$DEVENV_ROOT/scripts/dependencies-down.sh" "$@"
}

# GitHub Issues management
issue-create() {
    "$DEVENV_ROOT/scripts/issue-create.sh" "$@"
}

issue-list() {
    "$DEVENV_ROOT/scripts/issue-list.sh" "$@"
}

issue-update() {
    "$DEVENV_ROOT/scripts/issue-update.sh" "$@"
}

issue-close() {
    "$DEVENV_ROOT/scripts/issue-close.sh" "$@"
}

issue-select() {
    "$DEVENV_ROOT/scripts/issue-select.sh" "$@"
}

issue-groom() {
    "$DEVENV_ROOT/scripts/issue-grooming-wizard.sh" "$@"
}

# GitHub Projects management
project-add() {
    "$DEVENV_ROOT/scripts/project-add-issue.sh" "$@"
}

project-update() {
    "$DEVENV_ROOT/scripts/project-update-issue.sh" "$@"
}

# Run server containers
run-sql-server() {
    "$DEVENV_ROOT/scripts/server-run-sql.sh" "$@"
}

run-smb-server() {
    "$DEVENV_ROOT/scripts/server-run-smb.sh" "$@"
}

# MongoDB backup/restore
mongo-backup() {
    "$DEVENV_ROOT/scripts/mongo-backup-server.sh" "$@"
}

mongo-restore() {
    "$DEVENV_ROOT/scripts/mongo-restore-server.sh" "$@"
}

# NuGet local development
nuget-clear() {
    "$DEVENV_ROOT/scripts/nuget-clear-local.sh" "$@"
}

nuget-publish-debug() {
    "$DEVENV_ROOT/scripts/nuget-publish-debug-local.sh" "$@"
}

# Get public IP
get-public-ip() {
    "$DEVENV_ROOT/scripts/get-public-ip.sh" "$@"
}

# Update Tailscale auth key
update-tailscale-key() {
    "$DEVENV_ROOT/scripts/update-tailscale-key.sh" "$@"
    # Source the updated env-vars to reload in current shell
    if [ -f "$DEVENV_ROOT/.devcontainer/env-vars.sh" ]; then
        source "$DEVENV_ROOT/.devcontainer/env-vars.sh"
    fi
}
